<div class="chat-panel-container" [class.expanded]="isExpanded">
  <!-- Header -->
  <div class="chat-header" (click)="toggleExpand()">
    <div class="chat-title">
      <mat-icon>chat_bubble_outline</mat-icon>
      <span>Active Chats</span>
    </div>
    <div class="header-actions">
      <button mat-icon-button class="toggle-btn">
        <mat-icon>{{ isExpanded ? 'expand_less' : 'expand_more' }}</mat-icon>
      </button>
    </div>
  </div>

  @if (isExpanded) {
  <div class="chat-content">
    <!-- Tab Navigation -->
    <div class="chat-tabs">
      <button class="tab-btn" [class.active]="selectedTab === 'rooms'" (click)="selectTab('rooms')">
        Active
      </button>
      <button class="tab-btn" [class.active]="selectedTab === 'friends'" (click)="selectTab('friends')">
        Friends
      </button>
    </div>

    <div class="list-container">
      @if (selectedTab === 'rooms') {
      <!-- Mission Rooms -->
      @if (chatRooms.length > 0 || privateChats.length > 0) {
      <div class="list-section">
        @if (chatRooms.length > 0) {
        <div class="section-label">Missions</div>
        @for (room of chatRooms; track room.id) {
        <div class="chat-item" (click)="selectRoom(room)">
          <mat-icon>forum</mat-icon>
          <span class="chat-name">{{ room.name }}</span>
        </div>
        }
        }

        @if (privateChats.length > 0) {
        <div class="section-label">Private Messages</div>
        @for (p of privateChats; track p.username) {
        <div class="chat-item" (click)="startPrivateChat(p)">
          <mat-icon>person</mat-icon>
          <span class="chat-name">{{ p.display_name }}</span>
          <button class="close-btn"
            (click)="$event.stopPropagation(); closeChat({id: -1, name: p.display_name, username: p.username})">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        }
        }
      </div>
      } @else {
      <div class="empty-state">
        <mat-icon>chat_outlined</mat-icon>
        <p>No active chats</p>
      </div>
      }
      }

      @if (selectedTab === 'friends') {
      <!-- Friends List to start DM -->
      @if (friendsList().length > 0) {
      <div class="list-section">
        @for (f of friendsList(); track f.username) {
        <div class="chat-item" (click)="startPrivateChat(f)">
          <div class="avatar-sm">
            <mat-icon>person</mat-icon>
          </div>
          <div class="item-info">
            <span class="chat-name">{{ f.display_name }}</span>
            <span class="chat-status">@{{ f.username }}</span>
          </div>
        </div>
        }
      </div>
      } @else {
      <div class="empty-state">
        <mat-icon>people_outline</mat-icon>
        <p>No friends online</p>
      </div>
      }
      }
    </div>
  </div>
  }
</div>